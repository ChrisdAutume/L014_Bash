#!/bin/bash

# $1 RacineA/
# $2 RacineB/
# $3 Chemin/
# $4 niveau de récurcivité

RacineA=$1
RacineB=$2
Chemin=$3
NbRecur=$4

function MAJ {
  #$1 RacineA
  #$2 Fichier/directory à déplacer
  #$3 Chemin à le mettre
  #$4 avec écriture dans le .synchro


  cp -rf--preserve=timestamps $2 $3
  if [[ $4 -eq 1 ]]; then
    if [[ -d $2 ]]; then
      echo `sed "s|^\(\$1\)\(.*\)$|\1 \2|" <<< "$2"` `stat -c "%a" $2` `stat -c "%Y" $2` `stat -c "%s" $2` `stat -c "%g" $2` `stat -c "%u" $2` >> /.synchro
      ecrire_synchro $2 $1
    else
      echo `sed "s|^\(\$1\)\(.*\)$|\1 \2|" <<< "$2"` `stat -c "%a" $2` `stat -c "%Y" $2` `stat -c "%s" $2` `stat -c "%g" $2` `stat -c "%u" $2` >> /.synchro
    fi
  fi
}

function TestSynchro {

  #$1 RacineA/
  #$2 RacineB/
  #$3 Chemin/
  #$4 niveau de récurcivité


  if [[ -f $1$3 && !(-f $2$(basename $1)$3) && -n $(egrep '^\$1 \$3 .+$' $RacineB/.synchro) ]]; then #si est dans RacineA, pas dans RacineB et dans le .synchro
    MAJ $1 $1$3 $2$3 1
  fi
}


for fichier in $(ls $RacineA$Chemin); do
  $(dirname $0)/TestSynchro $1 $2 $3$fichier $4
done

for fichier in $(ls $RacineB$(basename $RacineA)/$Chemin); do
  #test B avec J
done
if [[ $5 -eq 0 ]]; then
  #test J pour ligne en trop
  echo ----------------------------------------------------------------
  echo FIN

  #régler conflit
fi
